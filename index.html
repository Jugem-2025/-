<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ストレスチェックシート</title>
  <style>
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      margin: 0; padding: 20px; line-height: 1.6;
    }
    .container {
      max-width: 960px;
      margin: auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; color: #333; margin-bottom: 0.5em; }

    /* 過去記録へのリンク */
    .view-results {
      display: inline-block;
      margin-bottom: 1em;
      color: #1976d2;
      text-decoration: none;
    }
    .view-results:hover { text-decoration: underline; }

    /* ３列フレックス */
    .levels-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 1.5em;
    }
    .level-group {
      flex: 1 1 calc(33.333% - 20px);
      min-width: 260px;
      background: #fafafa;
      border-radius: 6px;
      padding: 1em;
      box-sizing: border-box;
      border-left: 4px solid transparent;
    }
    .level-keido { border-color: #4CAF50; }
    .level-chudo { border-color: #FFA500; }
    .level-juudo { border-color: #F44336; }
    .level-group h2 { margin-top: 0; font-size: 1.2em; }

    /* 折りたたみカテゴリ */
    details {
      margin: 0.5em 0;
      background: #fff;
      border-radius: 4px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }
    summary {
      padding: 0.6em 1em;
      cursor: pointer;
      font-weight: bold;
      background: #e8e8e8;
      position: relative;
    }
    summary::marker { display: none; }
    summary::before {
      content: "▶";
      display: inline-block;
      margin-right: 0.5em;
      transition: transform 0.2s;
    }
    details[open] > summary::before { content: "▼"; }
    .checkbox-list {
      padding: 0.5em 1em 1em 1.5em;
    }
    .checkbox-list label {
      display: block;
      margin: 0.2em 0;
      cursor: pointer;
    }
    .checkbox-list input { margin-right: 0.5em; transform: scale(1.1); }

    /* 備考欄 */
    textarea {
      width: 100%;
      height: 80px;
      margin-top: 1em;
      padding: 0.6em;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }

    /* 保存ボタン */
    button {
      display: block;
      width: 100%;
      margin-top: 1em;
      padding: 0.8em;
      font-size: 1em;
      color: #fff;
      background: #1976d2;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #155a9c; }

    /* プレビュー */
    #solutionPreview {
      margin-top: 2em;
      padding: 1em;
      background: #fff;
      border-radius: 6px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
      min-height: 120px;
    }
    .coping {
      margin-bottom: 1em;
      padding: 0.8em;
      border-radius: 4px;
      background: #fdfdfd;
      border-left: 4px solid transparent;
    }
    .coping[data-level="軽度"]  { border-color: #4CAF50; }
    .coping[data-level="中度"]  { border-color: #FFA500; }
    .coping[data-level="重度"]  { border-color: #F44336; }
    .coping h4 { margin: 0 0 0.4em; font-size: 1em; }

    @media (max-width: 800px) {
      .level-group { flex: 1 1 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ストレスチェックシート</h1>
    <a href="results.html" class="view-results">▶ 過去の記録を見る</a>

    <form id="stressForm">
      <div class="levels-container" id="checkboxContainer"></div>

      <h2>備考</h2>
      <textarea id="notes" placeholder="ここにメモを入力…"></textarea>

      <button type="button" id="saveBtn">保存して結果を見る</button>
    </form>

    <h2>対処法プレビュー</h2>
    <div id="solutionPreview"></div>
  </div>

  <script>
    // Excelの大構造を忠実にデータ化
    const data = {
      "軽度": {
        "身体症状": ["持続するかゆみ","寝不足","疲労感"],
        "行動(増)": ["間食をする・甘いものを買う","過集中してしまう","自分よりも人を優先する"],
        "行動(減)": ["運動が減る","食事が増える／減る"],
        "心理": ["そわそわ","集中できない","落ち着きがない時間帯が出てくる"],
        "仕事": ["連絡を返すのが面倒と感じる","残業をせず早く帰る","経理処理が遅れる","別の業務を進める"],
        "私事": ["自分を振り返る(7コラムなどのツールを使う)","一人で食事をとる","リフレッシュの時間をとる","タスクを整理する時間を作る","AIに相談"]
      },
      "中度": {
        "身体症状": ["腹痛","かゆみによる掻き傷","不眠","動悸","肩こり","瞼の痙攣","腰痛","朝起きられなくなる"],
        "行動(増)": ["理席が増える","外食が増える","ミスが増える","ダラダラする","タバコが増える","ネットの時間が増える"],
        "行動(減)": ["運動をしなくなる","朝食を抜く","声が小さくなる","忘れ物をする"],
        "心理": ["連絡を躊躇する","映画や音楽を楽しめなくなる","イライラ","連絡を返す頻度が落ちる","全く落ち着いていない","焦燥感","出来について不安になる","不自然に元気にふるまう","話がまとまらない","攻撃性","決断ができなくなる","自信が低下する","相談が億劫になる","心配"],
        "仕事": ["深夜帰宅が増える","早退を使う","出勤時刻が遅くなる","有給を1週間以内に取る","休みを減らさない","業務の相談をする","経理処理の督促が来る"],
        "私事": ["とにかく外在化をする"]
      },
      "重度": {
        "身体症状": ["複数回の突発的な下痢","重度の不眠(3時以降の就寝)","動悸","微熱","かぜ","生活に支障のある腰痛","起き上がれない"],
        "行動(増)": ["タクシー通勤","貧乏ゆすり"],
        "行動(減)": ["連絡がほぼできない","会話が減る","返事が単調になる","歩くのが遅くなる","連絡できない"],
        "心理": ["感情の起伏がなくなる","強い焦燥感","何も決断できない","あきらめ","混乱","罪悪感","自己嫌悪","自責の念"],
        "仕事": ["残業申告を削る","大事な業務に遅刻をする","業務軽減のお願いをする","締め切りを守れなくなる","通勤で精一杯"],
        "私事": ["家にまっすぐ帰れなくなる","家から出れなくなる","通勤できなくなる","家族や友人への連絡もしなくなる"]
      }
    };

    // 対処法１・２（Excel の列を転記）
    const coping = {
      "軽度": {
        coping1: ["寝る","さんぽをする","公園でボーっとする","カフェでおいしいコーヒーを飲む","マインドフルネス","ストレッチ","セルフマッサージ","運動","登山","おいしいものを食べる","人と話す","飲みに行く"],
        coping2: []
      },
      "中度": {
        coping1: ["寝る（とにかくまず寝る、寝すぎない）","相談をする","マインドフルネス","温泉","海","カフェイン・アルコールを控える","マッサージ","日光浴","ゆっくり温泉や銭湯を楽しむ","自分の気持ちを優先する","おいしいものをゆっくり食べる","料理をする","スマホから手を放す","美容室に行く","上司に１ON1のお願いをする","問題解決シートを書き、上司と対応策について相談"],
        coping2: []
      },
      "重度": {
        coping1: ["即刻受診","すぐに数日の休みを取る"],
        coping2: []
      }
    };

    const categories = ["身体症状","行動(増)","行動(減)","心理","仕事","私事"];
    const levelClass = { "軽度":"level-keido", "中度":"level-chudo", "重度":"level-juudo" };

    // ① 動的にチェックボックスを描画
    const container = document.getElementById("checkboxContainer");
    Object.keys(data).forEach(level => {
      const div = document.createElement("div");
      div.className = `level-group ${levelClass[level]}`;
      div.innerHTML = `<h2>${level}</h2>`;
      categories.forEach(cat => {
        const det = document.createElement("details");
        const sum = document.createElement("summary");
        sum.textContent = cat;
        const boxList = document.createElement("div");
        boxList.className = "checkbox-list";
        data[level][cat].forEach(text => {
          const label = document.createElement("label");
          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.name = "symptom";
          cb.value = text;
          cb.dataset.level = level;
          cb.dataset.category = cat;
          label.append(cb, " " + text);
          boxList.appendChild(label);
        });
        det.append(sum, boxList);
        div.appendChild(det);
      });
      container.appendChild(div);
    });

    // ② プレビュー更新
    const preview = document.getElementById("solutionPreview");
    function updatePreview() {
      preview.innerHTML = "";
      const checked = Array.from(document.querySelectorAll('input[name="symptom"]:checked'));
      const levels = [...new Set(checked.map(cb => cb.dataset.level))];
      levels.forEach(level => {
        // 対処法１
        const p1 = document.createElement("div");
        p1.className = "coping";
        p1.dataset.level = level;
        p1.innerHTML = `<h4>${level} の対処法１</h4>` +
          coping[level].coping1.map(t => `<p>・${t}</p>`).join("");
        preview.appendChild(p1);
        // 対処法２（あれば）
        if (coping[level].coping2.length) {
          const p2 = document.createElement("div");
          p2.className = "coping";
          p2.dataset.level = level;
          p2.innerHTML = `<h4>${level} の対処法２</h4>` +
            coping[level].coping2.map(t => `<p>・${t}</p>`).join("");
          preview.appendChild(p2);
        }
      });
    }
    document.querySelectorAll('input[name="symptom"]').forEach(cb => cb.addEventListener("change", updatePreview));
    updatePreview();

    // ③ 保存して results.html へ
    document.getElementById("saveBtn").addEventListener("click", () => {
      const notes = document.getElementById("notes").value.trim();
      const checked = Array.from(document.querySelectorAll('input[name="symptom"]:checked'));
      const entry = {
        timestamp: new Date().toLocaleString(),
        symptoms: checked.map(cb => ({
          level: cb.dataset.level,
          category: cb.dataset.category,
          text: cb.value
        })),
        notes
      };
      const existing = JSON.parse(localStorage.getItem("stressEntries") || "[]");
      existing.push(entry);
      localStorage.setItem("stressEntries", JSON.stringify(existing));
      location.href = "results.html";
    });
  </script>
</body>
</html>
